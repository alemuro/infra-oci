# My OCI instance

### Deploy infrastructure

Creates an instance on the Oracle Cloud (OCI) with ARM64 with 24GB of RAM and 4 vCPUs, and registers that instance to Cloudflare.

```
$ cd terraform-infra
$ terraform init
$ terraform apply
```

Ansible requires port 22 to be open or you won't be able to access to the instance. Also, replace my public SSH key by your own. Check `open_ports` local variable.

### Bootstrap server

Install:
* `k3s` - Lightweight kubernetes cluster.
* `tailscale` - Zero trust access VPN. **Note**: Replace the current token from the playbook file by a new one generated by your account.

```
$ cd ansible
$ ansible-galaxy install -r requirements.yml
$ ansible-playbook playbook.yaml -i inventory -t k3s
$ ansible-playbook playbook.yaml -i inventory -t tailscale # optional
```

You can copy the kubeconfig file from the instance. It is located in this path from the instance: `/etc/rancher/k3s/k3s.yaml`. Replace the IP by the public one (or the one from Tailscale).

### Deploy some k8s helm charts

Install basic prometheus stack (prometheus, grafana, alertmanager).

```
$ cd terraform-k8s
$ terraform init
$ terraform apply
```

## Author

Aleix Murtra